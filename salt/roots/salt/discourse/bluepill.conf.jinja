# discourse-bluepill - Process manager for Discourse
#

description     "discourse-bluepill"

start on filesystem or runlevel [2345]
stop on runlevel [!2345]

respawn
respawn limit 10 5
umask 022

uid discourse
gid discourse

env RUBY_GC_MALLOC_LIMIT=90000000
env RAILS_ROOT=/var/www/discourse
env RAILS_ENV={{ pillar['discourse']['env'] }}
env NUM_WEBS={{ grains['num_cpus'] }}

console log

start script
  . /etc/profile.d/rvm.sh
  bluepill --no-privileged -c ~/.bluepill load /var/www/discourse/config/discourse.pill
end script
